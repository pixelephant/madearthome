//= require jquery.easing
//= require carousel
//= require mousewheel
//= require modal
//= require jquery.prettyLoader

$("document").ready(function(){
	
	$.prettyLoader({
		loader: '/assets/prettyLoader/ajax-loader.gif',
		bind_to_ajax: true
	});
	
	$("#last-viewed .carousel").jCarouselLite({
	        btnPrev: "#last-viewed .left",
	        btnNext: "#last-viewed .right",
		    mouseWheel: true,
		    visible: 6,
		    scroll: 2
	});
	
	$(".carousel").touchwipe({
	     wipeLeft: function() { $("#last-viewed .right").trigger("click"); },
	     wipeRight: function() { $("#last-viewed .left").trigger("click"); },
	     min_move_x: 20,
	     min_move_y: 20,
	     preventDefaultEvents: true
	});

	
	$(".quicklook").click(function(){
		var id = $(this).parents(".product").data("id");
		$(this).parents(".product").addClass("opened");
		$("#product-modal").data("next-id",$(this).parents(".product").next().data("id"));
		$("#product-modal").data("prev-id",$(this).parents(".product").prev().data("id"));
		$("#product-modal").modal({
			onClose: function (dialog) {
				$("#product-grid .opened").removeClass("opened");
				dialog.data.fadeOut('slow', function () {
					dialog.container.slideUp('slow', function () {
						dialog.overlay.fadeOut('slow', function () {
							$.modal.close(); // must call this!
						});
					});
				});
			},
			onOpen: function (dialog) {
				dialog.overlay.fadeIn('slow', function () {
					$.ajax({
					  type: 'GET',
					  url: "/products/"+id+".json",
					  success: function(resp){
						$("#product-modal .clearfix").html(resp);
						dialog.container.slideDown('slow', function () {
							dialog.data.fadeIn('slow');
						});
					}});
					
				});
			}
		});
		return false;
	});
	
	$("#modal-next,#modal-prev").click(function(){
		if($(this).attr("id") == "modal-prev"){
			if(!$("#product-grid .opened").prev().length) { return false;}
			var id = $("#product-modal").data("prev-id");
			$("#product-grid .opened").removeClass("opened").prev().addClass("opened");
		}
		else{
			if(!$("#product-grid .opened").next().length) { return false;}
			var id = $("#product-modal").data("next-id");
			$("#product-grid .opened").removeClass("opened").next().addClass("opened");
		}
		$.ajax({
		  type: 'GET',
		  url: "/products/"+id+".html",
		  success: function(resp){
			$("#product-modal .clearfix").html(resp);
			
			$("#product-modal").data("next-id",$("#product-grid .opened").next().data("id"));
			$("#product-modal").data("prev-id",$("#product-grid .opened").prev().data("id"));
		}});
		return false;
	});
	
});